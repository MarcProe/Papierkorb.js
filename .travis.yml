language: node_js

arch:
  - amd64
  - arm64

dist:
  - bionic

node_js:
  - "lts/*"
  - "10"
  - "14"

services:
  - mongodb

env:
  - NODE_ENV=travis

before_script:
  - sudo apt-get install -qq ghostscript
  - npm start
  - sleep 5

script:
  - npm test

after_script:
  - sleep 120
  - pm2 desc 0
  - pm2 stop all
  - sleep 5
  - cat /home/travis/.pm2/logs/www-out-0.log
  - cat /home/travis/.pm2/logs/www-error-0.log

notifications:
  email: false
