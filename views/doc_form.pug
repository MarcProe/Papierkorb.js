extends layout

block content
    div.row
        div.col.s8
            -var n = 0
            while n++ < docdata.previews
                img.preview(src='/doc/' + docdata._id + '/preview/' + n)
        div.col.s4
            form(method='POST' action='/doc/' + docdata._id + '/update/true')
                div.form-group
                    label(for='subject') Betreff:
                    input#subject.form-control(type='text', placeholder='Betreff' name='subject' value=docdata.subject)
                div.form-group
                    label(for='docdate') Datum:
                    if(docdata.founddate)
                        input#docdate.form-control.datepicker.red-text(type='text', placeholder='Datum' name='docdate' value=(moment(docdata.docdate, 'DD.MM.YYYY').format("DD.MM.YYYY")))
                    else
                        input#docdate.form-control.datepicker(type='text', placeholder='Datum' name='docdate' value=(moment(docdata.docdate, 'DD.MM.YYYY').format("DD.MM.YYYY")))
                div.form-group
                    label(for='users') Besitzer:
                    br
                    each user in users
                        if(docdata.users.indexOf(user.name) > -1)
                            input(type='checkbox' id='user_' + user.name name='users' value=user.name checked='checked')
                        else
                            input(type='checkbox' id='user_' + user.name name='users' value=user.name)
                        label(for='user_' + user.name)= user.name
                        br
                        br
                div.form-group
                    -var partnerval = '';
                    if(docdata.partner)
                        -partnerval = docdata.partner
                    label(for='partner') Partner:
                    input#partner.autocomplete(name='partner' value=partnerval)

                div.row &nbsp;
                div.row
                    div.col.s6
                        button.btn.blue(type='submit') Aktualisieren
                    div.col.s6
                        a(href='/doc/')
                            button.btn.blue(type='button') Zurück
            textarea.doctext= docdata.plaintext


    script.
        //Initialize Datepicker
        $(document).ready(function () {
            $('.datepicker').pickadate({
                onStart: function() {
                    year = moment($('#docdate').val(), 'DD.MM.YYYY').format("YYYY");
                    month = moment($('#docdate').val(), 'DD.MM.YYYY').format("MM");
                    day = moment($('#docdate').val(), 'DD.MM.YYYY').format("DD");
                    this.set(year, month, day);
                },
                format: 'dd.mm.yyyy',
                selectMonths: true, // Creates a dropdown to control month
                selectYears: 15, // Creates a dropdown of 15 years to control year,
                today: 'Heute',
                clear: 'L&ouml;schen',
                close: 'Ok',
                closeOnSelect: false, // Close upon selecting a date,
                monthsFull: ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
                monthsShort: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
                weekdaysShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
                firstDay: 1,
                min: false,
                max: 365
            });
        });
        //Initialize Select
        $(document).ready(function () {
            $('select').material_select();
        });
        //Initialize Partner Autocomplete
        $(document).ready(function () {

            var docdata = !{JSON.stringify(docdata).replace(/<\//g, '<\\/')}
            var partnerlist = {};
            for (index = 0; index < docdata.partnerlist.length; ++index) {
                partnerlist[docdata.partnerlist[index].name] = docdata.partnerlist[index].logo;
            }
            console.log(partnerlist);

            $('#partner').autocomplete({
                data: partnerlist,
                limit: 20, // The max amount of results that can be shown at once. Default: Infinity.
                onAutocomplete: function (val) {
                    // Callback function when value is autcompleted.
                },
                minLength: 1, // The minimum length of the input for the autocomplete to start. Default: 1.
            });

            $("#partner").on('click', function () {
                    $(this).val('')
            });
        });
